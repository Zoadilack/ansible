---
- name: make ssl dir
  file: dest=/etc/nginx/ssl state=directory mode=0755 owner=www-data group=www-data
  become: true

- name: create self-signed SSL cert
  command: openssl req -new -nodes -x509 -subj "/C=US/ST=Washington/L=Seattle/O=IT/CN=${ansible_fqdn}" -days 3650 -keyout /etc/nginx/ssl/{{appname}}.key -out /etc/nginx/ssl/{{appname}}.crt -extensions v3_ca creates=/etc/nginx/ssl/{{appname}}.crt

- stat: path=/var/swapfile
  register: swapfile

# @TODO: automate this with Ansible instead of a shell script
- name: create swapfile
  shell: bash /var/www/{{appname}}/provisioning/misc/scripts/swapfile.sh
  when: swapfile.stat.exists == False
  become: true